/* ── Design Tokens ── */
:root{
  --sp-2:8px;--sp-3:12px;--sp-4:16px;--sp-5:20px;--sp-6:24px;--sp-7:32px;
  --bg:#0c1220;--bg-raised:#111827;--bg-surface:#1a2332;
  --card:rgba(26,35,50,.78);
  --border:rgba(55,65,81,.45);--border-subtle:rgba(55,65,81,.25);
  --text:#e8ecf1;--text-secondary:#b0bac9;--muted:#8494a7;
  --accent:#5b8def;--accent-hover:#7aa3f5;--accent-glow:rgba(91,141,239,.12);
  --accent-gradient:linear-gradient(135deg,#5b8def 0%,#8b6cf6 100%);
  --success:#34d399;--success-bg:rgba(52,211,153,.1);--danger:#f87171;--danger-bg:rgba(248,113,113,.1);--warning:#fbbf24;--warning-bg:rgba(251,191,36,.1);
  --font-sans:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  --font-mono:'JetBrains Mono','SF Mono',Consolas,monospace;
  --text-xs:11px;--text-sm:13px;--text-base:15px;--text-lg:17px;--text-xl:20px;--text-2xl:25px;
  --weight-medium:500;--weight-semibold:600;--weight-bold:700;
  --tracking-tight:-0.02em;--tracking-wide:0.04em;
  --radius-sm:6px;--radius-md:10px;--radius-lg:14px;--radius-xl:18px;--radius-full:9999px;
  --shadow-md:0 4px 16px rgba(0,0,0,.16),0 1px 4px rgba(0,0,0,.1);
  --shadow-lg:0 8px 32px rgba(0,0,0,.2),0 2px 8px rgba(0,0,0,.12);
  --z-dropdown:10;--z-sticky:20;--z-overlay:40;--z-modal:50;--z-toast:70;
  --ease-out:cubic-bezier(0.16,1,0.3,1);--ease-spring:cubic-bezier(0.34,1.56,0.64,1);--ease-smooth:cubic-bezier(0.4,0,0.2,1);
  --dur-fast:150ms;--dur-normal:250ms;--dur-slow:400ms
}
*{box-sizing:border-box}
body{font-family:var(--font-sans);background:var(--bg);color:var(--text);margin:0;font-size:var(--text-base);line-height:1.55;letter-spacing:-0.01em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
::selection{background:rgba(91,141,239,.3);color:#fff}
::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(100,116,139,.3);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:rgba(100,116,139,.5)}
:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:var(--radius-sm)}
/* ── Cards ── */
.card{background:var(--card);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:var(--shadow-md),inset 0 1px 0 rgba(255,255,255,.04);transition:border-color var(--dur-normal) var(--ease-smooth),box-shadow var(--dur-normal) var(--ease-smooth),transform var(--dur-normal) var(--ease-smooth)}
.card:hover{border-color:rgba(91,141,239,.18);box-shadow:var(--shadow-lg),inset 0 1px 0 rgba(255,255,255,.04),0 0 24px var(--accent-glow)}
/* ── Buttons ── */
.btn{padding:var(--sp-2) var(--sp-5);border-radius:var(--radius-sm);font-weight:var(--weight-semibold);cursor:pointer;transition:all var(--dur-normal) var(--ease-smooth);border:none;font-size:var(--text-sm);font-family:var(--font-sans);letter-spacing:-0.01em}
.btn-blue{background:var(--accent-gradient);color:#fff;box-shadow:0 2px 12px rgba(91,141,239,.25)}.btn-blue:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(91,141,239,.25);filter:brightness(1.08)}
.btn-blue:disabled{opacity:.45;cursor:not-allowed;transform:none;box-shadow:none;filter:none}
.btn-gray{background:rgba(71,85,105,.45);backdrop-filter:blur(8px);color:var(--text-secondary);border:1px solid rgba(100,116,139,.2)}.btn-gray:hover{background:rgba(100,116,139,.45);color:#fff;border-color:rgba(100,116,139,.35)}
.btn-red,.btn-green{padding:4px var(--sp-3);border-radius:var(--radius-sm);font-size:var(--text-sm);cursor:pointer;border:1px solid;transition:all var(--dur-fast) var(--ease-smooth);font-family:var(--font-sans)}
.btn-red{background:rgba(239,68,68,.15);color:var(--danger);border-color:rgba(239,68,68,.2)}
.btn-red:hover{background:rgba(239,68,68,.25);border-color:rgba(239,68,68,.4);box-shadow:0 2px 8px rgba(239,68,68,.15)}
.btn-green{background:rgba(34,197,94,.15);color:var(--success);border-color:rgba(34,197,94,.2);padding:4px var(--sp-4)}
.btn-green:hover{background:rgba(34,197,94,.25);border-color:rgba(34,197,94,.4);box-shadow:0 2px 8px rgba(34,197,94,.15)}
@keyframes pulse-green{0%{box-shadow:0 0 0 0 rgba(52,211,153,.4)}70%{box-shadow:0 0 0 8px rgba(52,211,153,0)}100%{box-shadow:0 0 0 0 rgba(52,211,153,0)}}
.pulse{animation:pulse-green 1s ease-out}
.btn-sm{padding:4px var(--sp-3);font-size:var(--text-xs);border-radius:var(--radius-sm)}
/* ── Inputs ── */
.inp{background:rgba(12,18,32,.7);border:1px solid var(--border);color:var(--text);padding:var(--sp-2) var(--sp-3);border-radius:var(--radius-sm);width:100%;font-size:var(--text-sm);font-family:var(--font-sans);transition:all var(--dur-normal) var(--ease-smooth)}
.inp:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow),0 0 20px var(--accent-glow);background:rgba(12,18,32,.9)}
.inp::placeholder{color:#5a6a7e}
/* ── Log / Progress ── */
.log{background:rgba(12,18,32,.7);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4);font-family:var(--font-mono);font-size:var(--text-xs);height:200px;overflow-y:auto;white-space:pre-wrap;line-height:1.65;color:var(--text-secondary)}
.pbar{height:6px;background:var(--border-subtle);border-radius:var(--radius-full);overflow:hidden;position:relative}
.pfill{height:100%;background:var(--accent-gradient);transition:width var(--dur-slow) var(--ease-out);border-radius:var(--radius-full);position:relative}
.pfill::after{content:'';position:absolute;right:0;top:-2px;bottom:-2px;width:12px;background:var(--accent);border-radius:var(--radius-full);animation:progressPulse 1.5s ease-in-out infinite}
/* ── Animations ── */
@keyframes fadeIn{from{opacity:0;transform:translateY(12px) scale(.97)}to{opacity:1;transform:none}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeInScale{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
@keyframes shimmer{0%{background-position:-600px 0}100%{background-position:600px 0}}
@keyframes progressPulse{0%,100%{box-shadow:0 0 8px var(--accent-glow)}50%{box-shadow:0 0 20px rgba(91,141,239,.25)}}
@keyframes spin{to{transform:rotate(360deg)}}
.fade{animation:fadeIn var(--dur-slow) var(--ease-out)}.fade-up{animation:fadeInUp var(--dur-slow) var(--ease-out)}.fade-scale{animation:fadeInScale var(--dur-slow) var(--ease-out)}
/* ── Skeleton shimmer ── */
.skeleton{background:linear-gradient(90deg,var(--bg-raised) 25%,rgba(55,65,81,.3) 50%,var(--bg-raised) 75%);background-size:1200px 100%;animation:shimmer 2s ease-in-out infinite;border-radius:var(--radius-sm)}
.skel-bar{height:16px;margin-bottom:var(--sp-2);border-radius:var(--radius-sm)}
.skel-box{border-radius:var(--radius-md)}
/* ── Manager cards ── */
.mgr-card.stagger{opacity:0;animation:fadeInUp var(--dur-slow) var(--ease-spring) forwards}
.ta-wrap{position:relative}
.ta-dd{position:absolute;top:100%;left:0;right:0;background:#1a2332;border:1px solid var(--border);border-radius:var(--radius-sm);max-height:240px;overflow-y:auto;z-index:var(--z-dropdown);display:none;box-shadow:var(--shadow-lg)}
.ta-dd.open{display:block}
.ta-item{padding:var(--sp-2) var(--sp-3);cursor:pointer;border-bottom:1px solid var(--border-subtle);display:flex;justify-content:space-between;align-items:center;transition:background var(--dur-fast) var(--ease-smooth)}
.ta-item:hover,.ta-item.sel{background:rgba(91,141,239,.08)}
.ta-item .n{color:var(--text);font-weight:var(--weight-medium)}.ta-item .m{color:var(--muted);font-size:var(--text-xs)}
.mgr-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:var(--sp-3)}
.mgr-card{background:var(--bg-raised);backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--sp-5) var(--sp-6);display:flex;justify-content:space-between;align-items:center;transition:all var(--dur-normal) var(--ease-smooth);border-left:3px solid var(--accent)}
.mgr-card:hover{border-color:rgba(99,148,234,.5);border-left-color:var(--accent-hover);background:rgba(30,42,58,.88);box-shadow:var(--shadow-md),0 0 24px var(--accent-glow);transform:translateY(-1px)}
.mgr-name{font-weight:var(--weight-semibold);font-size:var(--text-base);color:#fff;letter-spacing:var(--tracking-tight)}.mgr-cik{font-size:var(--text-xs);color:var(--muted);font-family:var(--font-mono);margin-top:2px}
/* ── Status chips ── */
.mgr-status{display:flex;flex-wrap:wrap;gap:4px;max-height:200px;overflow-y:auto}
.mgr-chip{padding:4px var(--sp-3);border-radius:var(--radius-full);font-size:var(--text-xs);background:var(--bg-raised);border:1px solid var(--border-subtle);color:var(--muted);white-space:nowrap;display:inline-flex;align-items:center;gap:4px;font-weight:var(--weight-medium);transition:all var(--dur-fast) var(--ease-smooth)}
.mgr-chip.ok{background:var(--success-bg);border-color:rgba(52,211,153,.2);color:var(--success)}
.mgr-chip.err{background:var(--danger-bg);border-color:rgba(248,113,113,.2);color:var(--danger)}
.mgr-chip.running{background:var(--accent-glow);border-color:rgba(91,141,239,.2);color:var(--accent)}
.spinner{width:10px;height:10px;border:2px solid var(--accent);border-top-color:transparent;border-radius:50%;display:inline-block;animation:spin .6s linear infinite}
/* ── Weight bar ── */
.wt-bar-wrap{background:var(--border-subtle);border-radius:var(--radius-full);height:24px;overflow:hidden;position:relative;margin-top:var(--sp-3)}
.wt-bar-fill{height:100%;background:var(--accent-gradient);transition:width var(--dur-slow) var(--ease-out);border-radius:var(--radius-full)}
.wt-bar-label{position:absolute;top:0;left:0;right:0;text-align:center;font-size:var(--text-xs);line-height:24px;color:#fff;font-weight:var(--weight-semibold)}
/* ── N-PORT series ── */
.nport-series-row{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);padding:var(--sp-2) var(--sp-3);margin-top:var(--sp-2);display:flex;gap:var(--sp-2);align-items:center}
/* ── Key Highlights ── */
.highlights-wrap{display:grid;grid-template-columns:1fr;gap:var(--sp-3);margin-bottom:var(--sp-6);padding-bottom:var(--sp-5);border-bottom:2px solid var(--border)}
.highlight-card{background:rgba(91,141,239,.06);border:1px solid rgba(91,141,239,.15);border-radius:var(--radius-md);padding:var(--sp-4) var(--sp-5)}
.highlight-title{font-size:var(--text-sm);font-weight:var(--weight-bold);color:#fff;margin-bottom:var(--sp-2);letter-spacing:var(--tracking-tight)}
.highlight-body{font-size:var(--text-sm);color:var(--text-secondary);line-height:1.65;margin:0}
/* ── Written Analysis ── */
.analysis-content{line-height:1.65}
.analysis-section{margin-bottom:var(--sp-5);padding-bottom:var(--sp-4);border-bottom:1px solid var(--border-subtle)}
.analysis-section:last-child{margin-bottom:0;border-bottom:none;padding-bottom:0}
.analysis-title{font-size:var(--text-sm);font-weight:var(--weight-bold);color:var(--accent);text-transform:uppercase;letter-spacing:var(--tracking-wide);margin-bottom:var(--sp-2)}
.analysis-text{font-size:var(--text-sm);color:var(--text-secondary);line-height:1.65}
/* ── Holdings Tables ── */
.holdings-table-wrap{margin-bottom:var(--sp-6)}
.holdings-table-title{font-size:var(--text-base);font-weight:var(--weight-bold);color:#fff;margin-bottom:var(--sp-3);letter-spacing:var(--tracking-tight)}
.table-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
.holdings-tbl{width:100%;border-collapse:collapse;font-size:var(--text-xs);white-space:nowrap}
.holdings-tbl th{text-align:left;padding:var(--sp-2) var(--sp-3);color:var(--muted);font-size:10px;text-transform:uppercase;letter-spacing:var(--tracking-wide);font-weight:var(--weight-semibold);border-bottom:2px solid var(--border);background:var(--bg-raised);position:sticky;top:0}
.holdings-tbl td{padding:var(--sp-2) var(--sp-3);border-bottom:1px solid var(--border-subtle);color:var(--text-secondary)}
.holdings-tbl tr:hover td{background:rgba(91,141,239,.04)}
.holdings-tbl .mono{font-family:var(--font-mono);font-size:var(--text-xs)}
.holdings-tbl .ticker{color:var(--accent);font-weight:var(--weight-bold);font-family:var(--font-mono)}
.holdings-tbl .stock-name{color:#fff;font-weight:var(--weight-medium);max-width:180px;overflow:hidden;text-overflow:ellipsis}
.holdings-tbl .sector-col,.holdings-tbl .industry-col{font-size:var(--text-xs);color:var(--muted);max-width:140px;overflow:hidden;text-overflow:ellipsis}
.holdings-tbl .ret-pos{color:var(--success)}
.holdings-tbl .ret-neg{color:var(--danger)}
.holdings-tbl .totals-row td{border-top:2px solid var(--accent);border-bottom:none;background:rgba(91,141,239,.06);font-weight:var(--weight-semibold);color:#fff}
.beat-pos{color:var(--success);font-weight:var(--weight-semibold)}
.beat-neg{color:var(--danger);font-weight:var(--weight-semibold)}
.beat-met{color:var(--warning);font-weight:var(--weight-medium)}
.table-footnote{font-size:10px;color:var(--muted);font-style:italic;margin-top:var(--sp-3);line-height:1.5;padding:var(--sp-2) 0}
/* ── Bar Chart Popup ── */
.bar-popup{position:absolute;z-index:var(--z-overlay);background:rgba(17,24,39,.92);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius-md);padding:var(--sp-4);min-width:220px;max-width:300px;box-shadow:var(--shadow-lg);animation:fadeInScale .2s var(--ease-spring)}
.bar-popup-title{font-size:var(--text-sm);font-weight:var(--weight-bold);color:#fff;margin-bottom:var(--sp-2);padding-bottom:var(--sp-2);border-bottom:1px solid var(--border-subtle)}
.bar-popup-list{display:flex;flex-direction:column;gap:2px}
.bar-popup-stock{display:flex;justify-content:space-between;align-items:center;padding:2px 0}
.bar-popup-name{font-size:var(--text-xs);color:var(--text-secondary);font-weight:var(--weight-medium)}
.bar-popup-pct{font-size:var(--text-xs);color:var(--accent);font-family:var(--font-mono);font-weight:var(--weight-semibold)}
.bar-popup-mgrs{font-size:10px;color:var(--muted);padding-left:var(--sp-2);margin-bottom:2px}
/* ── Modal System ── */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);z-index:var(--z-modal);display:flex;align-items:center;justify-content:center;animation:fadeIn var(--dur-fast) var(--ease-smooth)}
.modal-panel{background:rgba(17,24,39,.95);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:var(--shadow-lg),0 0 40px rgba(0,0,0,.3);padding:var(--sp-7);min-width:320px;max-width:440px;width:90%;animation:fadeInScale var(--dur-normal) var(--ease-spring)}
.modal-icon{font-size:32px;margin-bottom:var(--sp-4);text-align:center}
.modal-title{font-size:var(--text-lg);font-weight:var(--weight-bold);color:#fff;margin-bottom:var(--sp-2);letter-spacing:var(--tracking-tight)}
.modal-desc{font-size:var(--text-sm);color:var(--text-secondary);line-height:1.65;margin-bottom:var(--sp-6)}
.modal-input{width:100%;margin-bottom:var(--sp-5)}
.modal-actions{display:flex;gap:var(--sp-3);justify-content:flex-end}
.modal-actions .btn{min-width:90px;text-align:center}
/* ── Toast (class-based) ── */
.toast-wrap{position:fixed;bottom:24px;right:24px;background:rgba(26,35,50,.92);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);color:#fff;padding:14px 28px;border-radius:var(--radius-md);font-weight:var(--weight-medium);font-size:var(--text-sm);z-index:var(--z-toast);animation:fadeInUp .4s var(--ease-spring);box-shadow:var(--shadow-lg);border:1px solid var(--border);letter-spacing:-0.01em;display:flex;align-items:center;gap:var(--sp-2)}
.toast-success{border-left:3px solid var(--success)}
.toast-danger{border-left:3px solid var(--danger)}
/* ── Portfolio Posture Card ── */
.posture-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:var(--sp-5)}
.posture-tilt{font-size:var(--text-xl);font-weight:var(--weight-bold);color:#fff;letter-spacing:var(--tracking-tight)}
.posture-subtitle{font-size:var(--text-xs);color:var(--muted);margin-top:2px}
.posture-sentiment{display:inline-flex;align-items:center;gap:4px;padding:4px var(--sp-3);border-radius:var(--radius-full);font-size:var(--text-xs);font-weight:var(--weight-semibold)}
.posture-sentiment.constructive{background:var(--success-bg);color:var(--success);border:1px solid rgba(52,211,153,.2)}
.posture-sentiment.neutral{background:var(--warning-bg);color:var(--warning);border:1px solid rgba(251,191,36,.2)}
.posture-sentiment.cautious{background:var(--danger-bg);color:var(--danger);border:1px solid rgba(248,113,113,.2)}
.posture-stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--sp-3)}
.posture-stat{background:var(--bg-raised);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)}
.posture-stat-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:var(--tracking-wide);font-weight:var(--weight-semibold);margin-bottom:4px}
.posture-stat-value{font-size:var(--text-lg);font-weight:var(--weight-bold);color:#fff;font-family:var(--font-mono)}
/* ── Progressive Reveal ── */
.story-section{opacity:0;transform:translateY(20px);transition:opacity var(--dur-slow) var(--ease-smooth),transform var(--dur-slow) var(--ease-smooth)}
.story-section.visible{opacity:1;transform:translateY(0)}
/* ── Cross-linking ── */
.xlink{color:var(--accent);text-decoration:underline;text-decoration-style:dashed;text-underline-offset:2px;cursor:pointer;transition:color var(--dur-fast) var(--ease-smooth)}
.xlink:hover,.xlink:focus{color:var(--accent-hover);text-decoration-style:solid}
@keyframes rowHighlight{0%{background:rgba(251,191,36,.25)}100%{background:transparent}}
.xlink-highlight td{animation:rowHighlight 1.8s var(--ease-smooth) forwards}
/* ── Build Message ── */
.build-message{display:flex;align-items:center;gap:var(--sp-3);color:var(--muted);font-size:var(--text-sm);padding:var(--sp-6) 0}
.build-spinner{width:16px;height:16px;border:2px solid var(--accent);border-top-color:transparent;border-radius:50%;animation:spin .6s linear infinite;flex-shrink:0}
/* ── Mobile ── */
@media(max-width:767px){
  .mgr-grid{grid-template-columns:1fr}
  .mobile-header{flex-direction:column;gap:var(--sp-2);align-items:flex-start}
  .mobile-header-btns{flex-wrap:wrap;gap:var(--sp-2)}
  .nport-series-row{flex-wrap:wrap}
  .mobile-add-row{flex-direction:column}
  .mobile-add-row .ta-wrap{width:100%!important;flex:none!important}
  .mobile-add-row input[style*="width:140px"]{width:100%!important}
  .mobile-ctrl-wrap{flex-wrap:wrap;gap:var(--sp-2)}
  .table-scroll{max-width:calc(100vw - 40px)}
  .posture-stats-row{grid-template-columns:repeat(2,1fr)}
  .modal-panel{min-width:0;width:95%}
}
