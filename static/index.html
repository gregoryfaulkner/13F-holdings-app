<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Investment Manager Holdings</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
<!-- Header -->
<div style="background:rgba(12,18,32,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border-subtle);z-index:var(--z-sticky)" class="px-5 md:px-8 py-4 sticky top-0">
  <div class="flex items-center justify-between mobile-header">
    <div>
      <h1 style="font-size:var(--text-xl);font-weight:var(--weight-bold);color:#fff;letter-spacing:var(--tracking-tight);line-height:1.35">Investment Manager Holdings</h1>
      <p style="font-size:var(--text-xs);color:var(--muted);margin-top:2px;letter-spacing:var(--tracking-wide);text-transform:uppercase;font-weight:var(--weight-medium)">SEC 13F Filing Intelligence</p>
    </div>
    <div class="flex items-center gap-3 mobile-header-btns">
      <span id="sBadge" class="text-sm text-slate-400">Ready</span>
      <button id="resetBtn" class="btn btn-gray hidden" onclick="doReset()">&#8634; Reset</button>
      <button id="dlBtn" class="btn btn-gray hidden" onclick="dlAll()">&#128230; Download Excel</button>
      <button id="stopBtn" class="btn hidden" style="background:#ef4444;color:#fff" onclick="doStop()">&#9632; Stop</button>
      <button id="runBtn" class="btn btn-blue" onclick="doRun()">&#9654; Fetch Holdings</button>
    </div>
  </div>
  <!-- Progress bar -->
  <div id="progressRow" class="mt-2" style="display:none">
    <div class="flex items-center gap-3">
      <div class="pbar" style="flex:1"><div id="pFill" class="pfill" style="width:0%"></div></div>
      <span id="pText" class="text-xs text-slate-400 whitespace-nowrap"></span>
    </div>
    <div id="mgrStatus" class="mgr-status mt-1"></div>
    <details class="mt-1">
      <summary class="text-xs text-slate-500 cursor-pointer">Log</summary>
      <div id="logBox" class="log" style="max-height:120px">Waiting to start...</div>
    </details>
  </div>
</div>
<!-- Main -->
<div class="overflow-y-auto p-5 md:p-8" style="max-width:1200px;margin:0 auto">
  <!-- Add Manager -->
  <div class="card p-5 mb-5" style="position:relative;z-index:var(--z-dropdown)">
    <h3 class="text-sm font-semibold text-slate-300 mb-3">Add Manager / Fund</h3>
    <div class="flex gap-3 items-start mobile-add-row">
      <div class="ta-wrap" style="flex:1" id="taWrap">
        <input id="aName" class="inp" placeholder="Search 13F managers and mutual funds..." autocomplete="off"
               oninput="taInput()" onkeydown="taKey(event)" onfocus="taInput()">
        <div id="taDd" class="ta-dd"></div>
      </div>
      <input id="aCik" class="inp" style="width:140px" placeholder="CIK (auto-filled)">
      <button id="addMgrBtn" class="btn-green" onclick="addMgr()" style="white-space:nowrap;padding:8px 16px">+ Add</button>
    </div>
    <div id="nportSeriesRow" class="nport-series-row hidden">
      <span class="text-xs text-slate-400">Fund Series:</span>
      <select id="nSeries" class="inp" style="flex:1;padding:4px 8px;font-size:13px"><option value="">— Select series —</option></select>
      <input id="nSeriesManual" class="inp" style="max-width:180px;width:100%;padding:4px 8px;font-size:12px" placeholder="Or type keyword...">
      <button class="btn btn-sm btn-blue" onclick="addNportFromUnified()">Add Fund</button>
      <button class="btn btn-sm btn-gray" onclick="cancelNport()">Cancel</button>
    </div>
  </div>
  <!-- Managers -->
  <div class="card p-5 mb-5">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold text-white">Managers</h2>
      <div class="flex items-center gap-3 mobile-ctrl-wrap">
        <select id="presetSel" class="inp" style="min-width:140px;max-width:180px;padding:5px 8px;font-size:13px" onchange="loadPreset()">
          <option value="">— Presets —</option>
        </select>
        <button id="delPresetBtn" class="btn btn-sm btn-red hidden" onclick="deletePreset()">Delete Preset</button>
        <button class="btn btn-sm btn-gray" onclick="savePreset()">Save Preset</button>
        <button class="btn btn-sm btn-red" onclick="clearMgrs()">Clear All</button>
        <span id="mCnt" class="text-sm text-slate-400"></span>
      </div>
    </div>
    <div id="mGrid" class="mgr-grid"></div>
    <div id="wtBarArea" class="hidden" style="margin-top:12px">
      <div class="flex items-center justify-between mb-1">
        <span class="text-xs text-slate-400">Portfolio Weight Allocation</span>
        <span id="wtLabel" class="text-xs font-semibold text-slate-300"></span>
      </div>
      <div class="wt-bar-wrap">
        <div id="wtFill" class="wt-bar-fill" style="width:0%"></div>
        <div id="wtBarText" class="wt-bar-label"></div>
      </div>
    </div>
  </div>
  <!-- Settings (inline, collapsible) -->
  <details class="card mb-5">
    <summary class="p-5 text-sm font-semibold text-slate-300 cursor-pointer">Settings</summary>
    <div class="px-5 pb-5 space-y-3">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div><label class="text-xs text-slate-400">Top N Holdings</label>
          <input id="sTopN" type="number" class="inp" min="1" max="100" value="20"></div>
        <div><label class="text-xs text-slate-400">Reporting Quarter</label>
          <select id="sDate" class="inp"></select></div>
        <div><label class="text-xs text-slate-400">SEC Identity</label>
          <input id="sIdent" class="inp"></div>
      </div>
      <div class="flex items-center gap-2">
        <input id="sEnrich" type="checkbox" checked>
        <label for="sEnrich" class="text-sm text-slate-300">Enrich with financial data (yfinance)</label>
      </div>
      <button class="btn btn-blue" onclick="saveCfg()">Save Settings</button>
    </div>
  </details>
  <!-- Results area -->
  <div id="resArea" class="hidden">
    <!-- Results summary -->
    <div class="card p-5 mb-5">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-white">Results</h2>
        <div id="resSummary"></div>
      </div>
      <div id="csvLinks" class="flex flex-wrap gap-2"></div>
    </div>
    <!-- Portfolio Posture Card -->
    <div id="postureCard" class="card p-5 mb-5 story-section" style="display:none">
      <div class="posture-header">
        <div>
          <div id="postureTilt" class="posture-tilt"></div>
          <div class="posture-subtitle">Portfolio Posture</div>
        </div>
        <div id="postureSentiment" class="posture-sentiment"></div>
      </div>
      <div id="postureStats" class="posture-stats-row"></div>
    </div>
    <!-- Interleaved Story Area (dynamically populated) -->
    <div id="storyArea"></div>
  </div>
</div>
<script src="/static/js/app.js"></script>
</body></html>
